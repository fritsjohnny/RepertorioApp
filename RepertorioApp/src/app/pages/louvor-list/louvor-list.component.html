<div class="container">
  <h3 class="text-center">Buscar Louvor</h3>

  <input
    type="text"
    placeholder="Nome da Can√ß√£o (ex: Tremenda Gra√ßa)"
    [(ngModel)]="titulo"
    (keyup.enter)="filtrar()"
  />

  <input
    type="text"
    placeholder="Tema Principal (ex: Adora√ß√£o)"
    [(ngModel)]="tema"
    (keyup.enter)="filtrar()"
  />

  <input
    type="text"
    placeholder="Subtema (ex: Confian√ßa)"
    [(ngModel)]="subtema"
    (keyup.enter)="filtrar()"
  />

  <button (click)="filtrar()">Buscar</button>
  <button *ngIf="louvoresFiltrados.length" class="btn-clear" (click)="limpar()">
    Limpar Filtros
  </button>

  <div *ngIf="repertorioGerado">
    <h3>Repert√≥rio Gerado:</h3>
    <pre>{{ repertorioGerado }}</pre>

    <button class="btn-clear" (click)="limparSugestao()">
      Limpar sugest√£o
    </button>
  </div>

  <div class="center">
    <mat-spinner color="accent" *ngIf="!hideProgress"></mat-spinner>
  </div>

  <div *ngIf="hideProgress">
    <p *ngIf="louvoresFiltrados.length">
      {{ louvoresFiltrados.length }} louvor{{
        louvoresFiltrados.length === 1 ? "" : "es"
      }}
      encontrado{{ louvoresFiltrados.length === 1 ? "" : "s" }}
    </p>

    <p *ngIf="!louvoresFiltrados.length">Nenhum louvor encontrado.</p>

    <button
      class="share-btn"
      *ngIf="louvoresFiltrados.length"
      (click)="compartilharTodos()"
    >
      Compartilhar todos os resultados no WhatsApp
    </button>

    <div
      class="card"
      *ngFor="let l of louvoresFiltrados"
      (click)="abrirModalPorTitulo(l)"
    >
      <h3>{{ l.title }}</h3>
      <p>
        <strong>Tom:</strong> {{ l.key }} | <strong>BPM:</strong> {{ l.tempo }}
      </p>
      <p><strong>Tema:</strong> {{ l.theme }}</p>
      <p><strong>Subtemas:</strong> {{ l.tags }}</p>
    </div>
  </div>
</div>

<!-- Modal -->
<div class="modal" *ngIf="louvorSelecionado" (click)="fecharModal($event)">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <span class="close" (click)="fecharModal($event)">&times;</span>

    <h2 style="word-break: break-word; white-space: normal; padding-top: 25px">
      {{ louvorSelecionado.title }}
    </h2>

    <p><strong>Artista:</strong> {{ louvorSelecionado.artist || "‚Äî" }}</p>
    <p><strong>Tom:</strong> {{ louvorSelecionado.key || "‚Äî" }}</p>
    <p><strong>BPM:</strong> {{ louvorSelecionado.tempo || "‚Äî" }}</p>
    <p>
      <strong>Tipo de Louvor:</strong>
      {{ louvorSelecionado.worshipType || "‚Äî" }}
    </p>
    <p><strong>Tema:</strong> {{ louvorSelecionado.theme || "‚Äî" }}</p>
    <p><strong>Subtemas:</strong> {{ louvorSelecionado.tags || "‚Äî" }}</p>
    <p>
      <strong>Refer√™ncias B√≠blicas:</strong>
      {{ louvorSelecionado.bibleReferences || "‚Äî" }}
    </p>
    <p><strong>Link:</strong> {{ louvorSelecionado.externalLink || "‚Äî" }}</p>

    <ng-container *ngIf="louvorSelecionado.lyrics">
      <hr />
      <p><strong>Letra:</strong></p>
      <pre style="white-space: pre-wrap">{{ louvorSelecionado.lyrics }}</pre>
    </ng-container>

    <div class="button-group">
      <button class="edit-btn" (click)="editarLouvor(louvorSelecionado)">
        ‚úèÔ∏è Editar
      </button>
      <button class="delete-btn" (click)="excluirLouvor(louvorSelecionado)">
        üóëÔ∏è Excluir
      </button>
    </div>

    <button class="share-btn" (click)="compartilharWhatsApp(louvorSelecionado)">
      Compartilhar no WhatsApp
    </button>
  </div>
</div>
